以下のステップで、`app.py`の`/recommend`ルートを修正するための具体的なコードを提案します。このコードはFlaskを使ったWebアプリケーションにおいて、事前に準備された`historical_data.csv`を用いてロジスティック回帰モデルを訓練し、そのモデルを使用して予測を行います。

### ステップ 1: 必要なライブラリをインポートする

```python
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import StandardScaler
from flask import Flask, request, jsonify
```

### ステップ 2: データの読み込みと前処理

```python
# データを読み込む
data = pd.read_csv('historical_data.csv')

# 特徴量とターゲットを定義
X = data.drop('target', axis=1)  # 'target'列を除外
y = data['target']

# データを訓練セットとテストセットに分割
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 特徴量のスケーリング
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)
```

### ステップ 3: モデルの訓練

```python
# ロジスティック回帰モデルのインスタンスを作成し、訓練する
model = LogisticRegression()
model.fit(X_train_scaled, y_train)
```

### ステップ 4: Flaskアプリケーションの設定

```python
app = Flask(__name__)

@app.route('/recommend', methods=['POST'])
def recommend():
    # JSONリクエストから特徴量を取得
    features = request.json
    features_df = pd.DataFrame([features])
    
    # 特徴量をスケーリング
    features_scaled = scaler.transform(features_df)
    
    # 予測を実行
    prediction = model.predict_proba(features_scaled)[0, 1]
    
    # 確率をJSON形式で返す
    return jsonify({'probability': prediction})

if __name__ == '__main__':
    app.run(debug=True)
```

### ステップ 5: アプリケーションのテスト

このコードを実行する前に、`historical_data.csv`が正しいフォーマットで存在し、適切な特徴量とターゲット列を含んでいることを確認してください。また、POSTリクエストで適切なJSONデータが送信されることを確認し、ローカルでテストを行ってください。

### 注意点

- このコードは、データセットの特徴量が数値型であることを前提としています。カテゴリカル変数が含まれる場合は、適切なエンコーディング処理が必要です。
- エラーハンドリングは最小限にしています。実際のアプリケーションでは、より詳細な入力検証やエラーハンドリングが必要です。